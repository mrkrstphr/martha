<h2 class="page-title pull-left">
    <a href="/projects/view/<?= $this->build->getProject()->getId() ?>">
        <?= $this->build->getProject()->getName() ?></a> ::
    Build #<?= $this->build->getId() ?>
    <?= $this->buildStatus($this->build->getStatus()) ?>
</h2>

<?php if (!in_array($this->build->getStatus(), ['pending', 'building'])): ?>
<a class="btn btn-primary pull-right" href="<?=
    $this->url('build', ['action' => 'rebuild', 'id' => $this->build->getId()]) ?>">Rebuild</a>
<?php endif; ?>

<div class="clearfix"></div>

<div class="panel panel-default build-information">
    <div class="panel-heading">
        <span class="fa fa-wrench"></span>
        <strong>Build Information</strong>
    </div>
    <table class="table">
        <tbody>
            <tr>
                <th>Triggered On: </th>
                <td><?= $this->build->getCreated()->format('F jS, Y \\a\\t h:i A') ?></td>
                <th>Method: </th>
                <td><?= ucwords($this->build->getMethod()) ?></td>
            </tr>
            <tr>
                <th>Branch: </th>
                <td><?= $this->build->getBranch() ?></td>
                <th>Fork: </th>
                <td><?= ucwords($this->build->getFork()) ?></td>
            </tr>
            <tr>
                <th>RevNo: </th>
                <td><?= $this->build->getRevisionNumber() ?></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
</div>

<ul id="build-tabs" class="nav nav-tabs">
    <li<?= $this->build->getStatus() != 'building' ? ' class="active"' : '' ?>>
        <a href="#dashboard" data-toggle="tab">Dashboard</a>
    </li>
    <li>
        <a href="#build-steps" data-toggle="tab">Build Steps</a>
    </li>
    <?php foreach ($this->artifacts['tabbed'] as $key => $title): ?>
    <li>
        <a href="#<?= $key ?>"><?= $title ?></a>
    </li>
    <?php endforeach; ?>
    <li<?= $this->build->getStatus() == 'building' ? ' class="active"' : '' ?>>
        <a href="#raw-output" data-toggle="tab">
            <?php if ($this->build->getStatus() == 'building'): ?>
            <img alt="running" src="/images/running.gif">
            <?php endif; ?>
            Raw Output
        </a>
    </li>
</ul>
<div class="tab-content">
    <?php $this->inlineScript()->captureStart(); ?>
    $(document).ready(function() {
        $('#build-tabs a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        });
    });
    <?php $this->inlineScript()->captureEnd(); ?>
    <div class="tab-pane<?= $this->build->getStatus() != 'building' ? ' active' : '' ?>" id="dashboard">
        <?php foreach ($this->artifacts['dashboard'] as $name => $title): ?>
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><?= $title ?></h3>
            </div>
            <div class="panel-body">
                <?= $this->$name ?>
            </div>
        </div>
        <?php endforeach; ?>

        <?php foreach ($this->build->getAlerts() as $alert): ?>
            <?= $this->displayAlert($alert) ?>
        <?php endforeach; ?>
    </div>
    <div class="tab-pane" id="build-steps">
        <?php if (count($this->build->getSteps())): ?>
        <p>The following command were ran during the build process: </p>
        <ol>
            <?php foreach ($this->build->getSteps() as $step): ?>
            <li>
                <?= $this->buildStatus($step->getReturnStatus() == 0 ? 'success' : 'failure') ?>
                <?= $step->getCommand() ?>
            </li>
            <?php endforeach; ?>
        </ol>
        <?php else: ?>
        <div class="alert alert-info">
            <strong>Boring!</strong> This build hasn't generated any steps yet.
        </div>
        <?php endif; ?>
    </div>
    <?php foreach ($this->artifacts['tabbed'] as $key => $title): ?>
    <div class="tab-pane" id="<?= $key ?>">
        <?= $this->$key ?>
    </div>
    <?php endforeach; ?>
    <div class="tab-pane<?= $this->build->getStatus() == 'building' ? ' active' : '' ?>" id="raw-output">
        <p>The following output was generated by the build process:</p>
        <pre><?= $this->output ?></pre>
    </div>
</div>
